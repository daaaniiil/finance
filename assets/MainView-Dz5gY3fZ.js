import{u as z}from"./index-pNuMJmbi.js";import{d as j,r as A,a as ne,c as x,o as b,b as T,e as n,w as o,F as oe,f as le,u as a,g as m,h as ae,E as k,i as s,j as M,k as se,l as ue,m as re,n as d,t as v,p as ie,q as Y,s as de,v as me,x as pe,y as ce,z as ge}from"./index-CemPgitG.js";import{H as fe}from"./HighChartEarnings-BsN3XDnT.js";import{H as _e}from"./HighChartExpensesMonth-DPA_B8Ve.js";const ve={class:"form-add_earnings"},be=j({__name:"EarningsForm",setup(P){const t=z(),c=t.loading,h=A(),p=ne({month:"",amount:null}),D=x(()=>({month:{required:!0,trigger:"blur",message:"Выберите месяц"},amount:{required:!0,trigger:"blur",message:"Введите сумму"}})),N=async()=>{p.amount!==null?p.amount<=0?k.warning("Введите положительную сумму"):(await t.createUserDataEarnings(h,p),await t.updateBudget(p.amount,"earnings")):k.warning("Заполните форму")},L=x(()=>window.innerWidth<378?"top":"left"),F=new Date().getMonth(),$=w=>{const r=t.earnings.map(y=>y.month).includes(w),E=t.months.find(y=>y.label===w),V=E?E.value>F:!1;return r||V};return(w,u)=>{const r=s("el-option"),E=s("el-select"),V=s("el-form-item"),y=s("el-input"),U=s("el-button");return b(),T("div",ve,[n(a(se),{"label-position":L.value,ref_key:"form",ref:h,rules:D.value,model:p,"status-icon":"",disabled:a(c),onSubmit:u[2]||(u[2]=ae(()=>{},["prevent"]))},{default:o(()=>[n(V,{prop:"month",label:"Месяц"},{default:o(()=>[n(E,{modelValue:p.month,"onUpdate:modelValue":u[0]||(u[0]=g=>p.month=g),placeholder:"Выберите месяц"},{default:o(()=>[(b(!0),T(oe,null,le(a(t).months,(g,R)=>(b(),M(r,{key:R,label:g.label,value:g.label,disabled:$(g.label)},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(V,{prop:"amount",label:"Сумма"},{default:o(()=>[n(y,{type:"number",modelValue:p.amount,"onUpdate:modelValue":u[1]||(u[1]=g=>p.amount=g),modelModifiers:{number:!0},placeholder:"Введите сумму"},null,8,["modelValue"])]),_:1}),n(U,{onClick:N,loading:a(c),type:"primary"},{default:o(()=>u[3]||(u[3]=[m("Сохранить")])),_:1},8,["loading"])]),_:1},8,["label-position","rules","model","disabled"])])}}}),we={class:"main-page"},he={class:"income"},ye={class:"expenses"},Ve=j({__name:"MainView",setup(P){var q;const t=z(),c=ue(),h=l=>new Intl.NumberFormat("ru-RU").format(l);let p=new Date().getMonth()-1;p===-1&&(p=11);let D=new Date().getMonth();D===0&&(D=12);const N=(q=t.months.find(l=>l.value===D-1))==null?void 0:q.label,L=x(()=>t.earningsLastMonthAmount-t.expensesLastMonthAmount),F=x(()=>t.earnings.slice().sort((l,e)=>{const C=t.months.findIndex(i=>i.label===l.month);return t.months.findIndex(i=>i.label===e.month)-C})),$=x(()=>F.value.map(l=>({...l,amount:Math.floor((l.amount??0)/c.getRate)}))),w=A(!1),u=A({id:"",amount:null,month:""}),r=A(0),E=l=>{u.value={...l},r.value=l.amount,w.value=!0},V=async()=>{var l;if(u.value&&r.value&&r.value!==0)try{if(r.value!==u.value.amount){const e=(l=t.months.find(f=>f.label===u.value.month))==null?void 0:l.value,C=t.expenses.filter(f=>{const i=new Date(f.date);return i.getMonth()===e&&i.getFullYear()===new Date().getFullYear()}).reduce((f,i)=>f+(i.amount||0),0);if(r.value*=c.getRate,r.value>=C){await t.updateEarningsAmount(u.value.id,r.value,u.value.month),r.value/=c.getRate;const f=r.value-u.value.amount,i=f<0?"expenses":"earnings";await t.updateBudget(Math.abs(f),i),w.value=!1,k.success("Сумма успешно обновлена!")}else r.value*=c.getRate,r.value=u.value.amount,k.warning("Ваши раходы превышают заработок в выбранном месяце или заработок меньше 0")}else k.warning("Введите новую сумму!")}catch(e){console.error(e)}else k.warning("Введите сумму!")},y=l=>{navigator.clipboard.writeText(`Месяц: ${l.month}, Заработок: ${h(l.amount)}${c.getIcon}`),k.success("Скопировано успешно!")},U=async l=>{await t.deleteEarningsItemData(l.id,l.month),await t.updateBudget(l.amount,"expenses")},g=x(()=>F.value.map(l=>l.month).reverse()),R=x(()=>F.value.map(l=>l.amount).reverse());return re(async()=>{await t.nowNewYear(),await t.getUserEarnings(),await t.getUserExpenses(),await t.incomeExpensesEarnings(),await t.expensesDaysMonthLast(),await t.fetchBudget(),t.budget===0&&await t.initializeBudget()}),(l,e)=>{const C=s("el-breadcrumb-item"),f=s("el-breadcrumb"),i=s("el-card"),W=s("el-skeleton"),S=s("el-table-column"),G=s("el-icon"),B=s("el-button"),H=s("el-dropdown-item"),J=s("el-dropdown-menu"),K=s("el-dropdown"),O=s("el-table"),Q=s("el-input"),X=s("el-dialog"),Z=s("el-empty"),ee=s("router-link"),te=de("loading");return b(),T("div",we,[n(f,{separator:"/"},{default:o(()=>[n(C,{to:{name:"main-page"}},{default:o(()=>e[3]||(e[3]=[m("Главная")])),_:1}),n(C,null,{default:o(()=>e[4]||(e[4]=[m("Доходы & Расходы")])),_:1})]),_:1}),a(t).loading?(b(),M(i,{key:1},{default:o(()=>[n(W,{animated:""})]),_:1})):(b(),M(i,{key:0},{default:o(()=>[d("h2",null,[e[5]||(e[5]=m("Прошлый месяц «")),d("span",null,v(a(N)),1),e[6]||(e[6]=m("»"))]),e[10]||(e[10]=d("hr",null,null,-1)),d("h1",null,[e[7]||(e[7]=m("Заработок: ")),d("span",null,v(h(Number(a(t).earningsLastMonthAmount.toFixed())))+v(a(c).getIcon),1)]),d("h1",null,[e[8]||(e[8]=m("Доход: ")),d("span",he,v(h(Number(L.value.toFixed())))+v(a(c).getIcon),1)]),d("h1",null,[e[9]||(e[9]=m("Расходы: ")),d("span",ye,v(h(Number(a(t).expensesLastMonthAmount.toFixed())))+v(a(c).getIcon),1)])]),_:1})),n(i,null,{default:o(()=>[e[15]||(e[15]=d("h2",null,"Ваш заработок по месяцам",-1)),ie((b(),M(O,{data:$.value,style:{width:"100%"}},{default:o(()=>[n(S,{fixed:"",prop:"month",label:"Месяц",width:"100"}),n(S,{prop:"amount",label:"Сумма",align:"center","min-width":"120"},{default:o(_=>[d("span",null,v(h(_.row.amount))+v(a(c).getIcon),1)]),_:1}),n(S,{align:"center",label:"Действия",width:"130"},{default:o(_=>[n(K,{trigger:"click"},{dropdown:o(()=>[n(J,{slot:"dropdown"},{default:o(()=>[n(H,{icon:a(me),onClick:I=>E(_.row)},{default:o(()=>e[12]||(e[12]=[m("Edit")])),_:2},1032,["icon","onClick"]),n(H,{icon:a(pe),onClick:I=>y(_.row)},{default:o(()=>e[13]||(e[13]=[m("Copy")])),_:2},1032,["icon","onClick"]),n(H,{icon:a(ce),onClick:I=>U(_.row),style:{color:"red"}},{default:o(()=>e[14]||(e[14]=[m("Delete ")])),_:2},1032,["icon","onClick"])]),_:2},1024)]),default:o(()=>[n(B,{class:"el-dropdown-link"},{default:o(()=>[n(G,null,{default:o(()=>[n(a(ge))]),_:1}),e[11]||(e[11]=d("i",{class:"el-icon-arrow-down el-icon--right"},null,-1))]),_:1})]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[te,a(t).loading]])]),_:1}),n(X,{title:"Редактировать сумму",modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=_=>w.value=_),width:"30%"},{footer:o(()=>[n(B,{type:"warning",onClick:e[1]||(e[1]=_=>w.value=!1)},{default:o(()=>e[16]||(e[16]=[m("Отменить")])),_:1}),n(B,{type:"primary",onClick:V},{default:o(()=>e[17]||(e[17]=[m("Сохранить")])),_:1})]),default:o(()=>{var _;return[d("p",null,"Измените сумма для месяца: "+v((_=u.value)==null?void 0:_.month),1),n(Q,{type:"number",modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=I=>r.value=I),modelModifiers:{number:!0},placeholder:"Введите новую сумму"},null,8,["modelValue"])]}),_:1},8,["modelValue"]),n(i,null,{default:o(()=>[e[18]||(e[18]=d("h2",null,"Добавить заработок за месяц",-1)),n(be)]),_:1}),a(t).expensesDaysLastMonth.length?(b(),M(_e,{key:2,expenses:a(t).expensesDaysLastMonth,month:a(p)},null,8,["expenses","month"])):Y("",!0),g.value.length===0?(b(),M(Z,{key:3,description:"Вы еще не добавили заработок"})):g.value.length?(b(),M(fe,{key:4,months:g.value,salaries:R.value,title:"Заработок"},null,8,["months","salaries"])):Y("",!0),n(ee,{to:{name:"analytics-page"}},{default:o(()=>[n(B,{type:"primary"},{default:o(()=>e[19]||(e[19]=[m("Детальная аналитика")])),_:1})]),_:1})])}}});export{Ve as default};
