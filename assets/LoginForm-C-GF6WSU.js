import{H as C,r as E,a as _,c as V,I as k,J as c,E as b,d as h,K as A,_ as F,i as m,o as g,b as B,L,n as $,e as l,w as u,h as N,j as w,g as y}from"./index-BBDC8gma.js";const P=(e,o)=>(n,r)=>{n===""?r(new Error("Пожалуйста, введите пароль")):n!==o.password?r(new Error("Два пароля не совпадают!")):r()},R=(e,o={})=>{const n=C(),r=E(!1),a=_({password:"",checkPass:"",email:"",phone:""}),p=V(()=>({password:{required:!0,trigger:"blur",message:"Введите пароль",min:6},checkPass:{required:!0,trigger:"blur",validator:P(e,a)},email:{required:!0,trigger:"blur",message:"Введите почту"}}));return{loading:r,model:a,rules:p,login:()=>{if(!e.value){console.error("Auth form not found");return}e.value.validate(async d=>{if(d){r.value=!0;try{const{data:s,error:t}=await k.auth.signInWithPassword({email:a.email,password:a.password});t?(console.error("Ошибка при входе:",t.message),c({title:"Ошибка!",message:"Не верный логин или пароль",type:"error"})):s.session&&(await k.auth.setSession(s.session),c({title:"Вход выполнен!",message:"Вы успешно вошли в аккаунт",type:"success"}),await n.push({name:"main-page"}))}catch(s){console.error("Error during login:",s)}finally{r.value=!1}}else console.error("Form validation failed"),r.value=!1})},register:()=>{if(!e.value){console.error("Auth form not found");return}e.value.validate(async d=>{if(d){r.value=!0;try{const{data:s,error:t}=await k.auth.signUp({email:a.email,password:a.password,options:{emailRedirectTo:"https://sunflower560.github.io/finance/"}});t?(console.error("Ошибка при регистрации:",t.message),c({title:"Ошибка!",message:"Произошла ошибка",type:"error"})):(b.success("Вы успешно зарегистрировались!"),c({title:"Подтвердите ваш email",message:"Проверьте почту, вам пришло письмо",type:"warning"}),console.log(s.session))}catch(s){console.error("Error during register:",s)}finally{r.value=!1}}else{console.error("Register form not found");return}})}}},S=h({name:"LoginForm",setup(){const e=A(),o=E(),{model:n,rules:r,loading:a,login:p,register:i}=R(o,{afterSignUp:{name:"main-page"},redirectToAttempt:!0});return{model:n,rules:r,loading:a,form:o,route:e,login:p,register:i}}}),U={class:"form-login"},q={class:"form-login-wrap"};function D(e,o,n,r,a,p){const i=m("el-input"),f=m("el-form-item"),d=m("el-form"),s=m("el-button"),t=m("router-link");return g(),B("div",U,[L(e.$slots,"title"),$("div",q,[l(d,{ref:"form",rules:e.rules,"status-icon":"",model:e.model,disabled:e.loading,onSubmit:o[2]||(o[2]=N(()=>{},["prevent"]))},{default:u(()=>[l(f,{prop:"email"},{default:u(()=>[l(i,{modelValue:e.model.email,"onUpdate:modelValue":o[0]||(o[0]=v=>e.model.email=v),size:"large",placeholder:"Почта"},null,8,["modelValue"])]),_:1}),l(f,{prop:"password"},{default:u(()=>[l(i,{modelValue:e.model.password,"onUpdate:modelValue":o[1]||(o[1]=v=>e.model.password=v),"show-password":"",size:"large",placeholder:"Пароль"},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model","disabled"]),l(f,null,{default:u(()=>[e.route.name==="login-page"?(g(),w(s,{key:0,type:"primary",loading:e.loading,onClick:e.login},{default:u(()=>o[3]||(o[3]=[y("Вход")])),_:1},8,["loading","onClick"])):(g(),w(s,{key:1,type:"primary",loading:e.loading,onClick:e.register},{default:u(()=>o[4]||(o[4]=[y("Зарегистрироваться")])),_:1},8,["loading","onClick"]))]),_:1}),e.route.name==="register-page"?(g(),w(t,{key:0,to:{name:"login-page"}},{default:u(()=>o[5]||(o[5]=[y("Уже есть аккаунт?")])),_:1})):(g(),w(t,{key:1,to:{name:"register-page"}},{default:u(()=>o[6]||(o[6]=[y("Еще нет аккаунта?")])),_:1}))])])}const z=F(S,[["render",D]]);export{z as L};
