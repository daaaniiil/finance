import{H as _,r as C,a as E,c as V,I as k,J as c,d as b,K as h,_ as A,i as m,o as p,b as F,L as B,n as L,e as l,w as u,h as $,j as w,g as y}from"./index-B3MjYFcB.js";const N=(e,o)=>(n,r)=>{n===""?r(new Error("Пожалуйста, введите пароль")):n!==o.password?r(new Error("Два пароля не совпадают!")):r()},P=(e,o={})=>{const n=_(),r=C(!1),a=E({password:"",checkPass:"",email:"",phone:""}),g=V(()=>({password:{required:!0,trigger:"blur",message:"Введите пароль",min:6},checkPass:{required:!0,trigger:"blur",validator:N(e,a)},email:{required:!0,trigger:"blur",message:"Введите почту"}}));return{loading:r,model:a,rules:g,login:()=>{if(!e.value){console.error("Auth form not found");return}e.value.validate(async d=>{if(d){r.value=!0;try{const{data:s,error:t}=await k.auth.signInWithPassword({email:a.email,password:a.password});t?(console.error("Ошибка при входе:",t.message),c({title:"Ошибка!",message:"Не верный логин или пароль",type:"error"})):s.session&&(await k.auth.setSession(s.session),c({title:"Вход выполнен!",message:"Вы успешно вошли в аккаунт",type:"success"}),await n.push({name:"main-page"}))}catch(s){console.error("Error during login:",s)}finally{r.value=!1}}else console.error("Form validation failed"),r.value=!1})},register:()=>{if(!e.value){console.error("Auth form not found");return}e.value.validate(async d=>{if(d){r.value=!0;try{const{data:s,error:t}=await k.auth.signUp({email:a.email,password:a.password,options:{emailRedirectTo:"https://sunflower560.github.io/finance/"}});t?(console.error("Ошибка при регистрации:",t.message),c({title:"Ошибка!",message:"Произошла ошибка",type:"error"})):(c({title:"Подтвердите ваш email",message:"Проверьте почту, вам отправлено письмо",type:"warning"}),console.log(s.session))}catch(s){console.error("Error during register:",s)}finally{r.value=!1}}else{console.error("Register form not found");return}})}}},R=b({name:"LoginForm",setup(){const e=h(),o=C(),{model:n,rules:r,loading:a,login:g,register:i}=P(o,{afterSignUp:{name:"main-page"},redirectToAttempt:!0});return{model:n,rules:r,loading:a,form:o,route:e,login:g,register:i}}}),S={class:"form-login"},U={class:"form-login-wrap"};function q(e,o,n,r,a,g){const i=m("el-input"),f=m("el-form-item"),d=m("el-form"),s=m("el-button"),t=m("router-link");return p(),F("div",S,[B(e.$slots,"title"),L("div",U,[l(d,{ref:"form",rules:e.rules,"status-icon":"",model:e.model,disabled:e.loading,onSubmit:o[2]||(o[2]=$(()=>{},["prevent"]))},{default:u(()=>[l(f,{prop:"email"},{default:u(()=>[l(i,{modelValue:e.model.email,"onUpdate:modelValue":o[0]||(o[0]=v=>e.model.email=v),size:"large",placeholder:"Почта"},null,8,["modelValue"])]),_:1}),l(f,{prop:"password"},{default:u(()=>[l(i,{modelValue:e.model.password,"onUpdate:modelValue":o[1]||(o[1]=v=>e.model.password=v),"show-password":"",size:"large",placeholder:"Пароль"},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model","disabled"]),l(f,null,{default:u(()=>[e.route.name==="login-page"?(p(),w(s,{key:0,type:"primary",loading:e.loading,onClick:e.login},{default:u(()=>o[3]||(o[3]=[y("Вход")])),_:1},8,["loading","onClick"])):(p(),w(s,{key:1,type:"primary",loading:e.loading,onClick:e.register},{default:u(()=>o[4]||(o[4]=[y("Зарегистрироваться")])),_:1},8,["loading","onClick"]))]),_:1}),e.route.name==="register-page"?(p(),w(t,{key:0,to:{name:"login-page"}},{default:u(()=>o[5]||(o[5]=[y("Уже есть аккаунт?")])),_:1})):(p(),w(t,{key:1,to:{name:"register-page"}},{default:u(()=>o[6]||(o[6]=[y("Еще нет аккаунта?")])),_:1}))])])}const T=A(R,[["render",q]]);export{T as L};
